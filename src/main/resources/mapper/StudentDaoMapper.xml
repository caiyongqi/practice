<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--<mapper namespace="com.graduation.practice.dao.UserDao">-->
<!--    <select id="findUserByAccount" parameterType="Student" resultType="Student">-->
<!--        SELECT * FROM user WHERE account = #{account}-->
<!--    </select>-->

<mapper namespace="com.graduation.practice.dao.StudentDao">
<!--   辅导员查询所带学生-->
    <select id="findStudentByStudentId" parameterType="Student" resultMap="studentMap">
        SELECT student.*,classes.id AS classes_id,classes.name AS classes_name ,
            discipline.id AS discipline_id,discipline.name AS discipline_name,
            college.id AS college_id,college.name AS college_name
        FROM student,classes,discipline,college
         WHERE studentId = #{studentId} AND student.classId = classes.id AND classes.disciplineId = discipline.id AND discipline.collegeId = college.id
    </select>
    <!--=========================== 学生界面 =====================================================-->
    <select id="findUserByAccount" parameterType="User" resultType="User">
        SELECT * FROM user WHERE account = #{account} and type=5
    </select>
    <!--    &#45;&#45;         select * FROM student_to_score where studentId = #{studentId}-->
    <!--    SELECT course.id as courseId, course.`name`, course.`desc`, course.credit, student_to_score.score, student_to_score.startTime, student_to_score.endTime FROM student_to_score, course WHERE course.id = student_to_score.courseId and studentId=#{studentId} ORDER BY id-->
    <select id="findStudentScore" parameterType="User" resultType="ScoreShow">
        SELECT course.id as courseId, course.`name`, course.`desc`, course.credit, student_to_score.score, student_to_score.startTime, student_to_score.endTime FROM student_to_score, course, student, user WHERE user.account=student.studentId and student.id=student_to_score.studentId and student_to_score.courseId = course.id and user.account=#{account} ORDER BY course.id
    </select>

    <!--    <select id="findCourseInfo" parameterType="list" resultType="Course">-->
    <!--        select * FROM course where id in-->
    <!--        <foreach collection="list" item="id" open="(" close=")" separator=",">-->
    <!--            #{id}-->
    <!--        </foreach>-->
    <!--    </select>-->

    <!--    学生信息获取-->
    <select id="findStudentInfo" parameterType="User" resultType="Student">
        SELECT * FROM student WHERE studentId = #{account}
    </select>
    <select id="findAllStudent" resultType="Student">
        SELECT * FROM student
        <if test="(studentName != null and studentName != '') or (classId != null and classId != 0)">
            where
        </if>
        <if test="studentName != null and studentName != ''">
            name like concat("%", #{studentName}, "%")
        </if>
        <if test="classId != null and classId != 0 and studentName != null and studentName != ''">
            and
        </if>
        <if test="classId != null and classId != 0">
            classId = #{classId}
        </if>
    </select>
    <insert id="insertStudent" parameterType="Student">
        INSERT INTO student (studentId,name,age,gender,address,email,phoneNumber,classId,date) VALUES (#{studentId},#{name},#{age},#{gender},#{address},#{email},#{phoneNumber},#{classId},#{date})
    </insert>

    <update id="updateStudent" parameterType="student">
        UPDATE student SET name = #{name}, age = #{age}, gender=#{gender}, address=#{address}, email=#{email}, phoneNumber=#{phoneNumber}, classId= #{classId},date=#{date} WHERE studentId=#{studentId}
    </update>

    <select id="adminFindStudentByStudentId" parameterType="String" resultType="Student">
        SELECT * FROM student WHERE studentId = #{studentId}
    </select>

    <delete id="deleteSelectedStudent" parameterType="List">
        DELETE FROM student WHERE studentId IN
        <foreach collection="list" item="studentId" open="(" close=")" separator=",">
            #{studentId}
        </foreach>
    </delete>

    <select id="findStudentById" parameterType="Student" resultType="Student">
        SELECT * FROM student WHERE id = #{id}
    </select>

    <!--    查询所有的教师课程信息 -->
    <select id="findCourseByTeacher" resultType="courseTeacher">
        SELECT teacher.name as teacherName,course.name as courseName,teacher_to_course.startTime, teacher_to_course.endTime,teacher_to_course.time from teacher,teacher_to_course,course WHERE teacher_to_course.teacherId=teacher.teacherId and teacher_to_course.courseId=course.id
    </select>

    <!-- 多对一关系 -->
    <resultMap type="Student" id="studentMap">
        <id column="id" property="id" />
        <result column="name" property="name" />
        <result column="studentId" property="studentId" />
        <result column="gender" property="gender" />
        <result column="age" property="age" />
        <result column="address" property="address" />
        <result column="email" property="email" />
        <result column="phoneNumber" property="phoneNumber" />
        <result column="classId" property="classId" />
        <result column="photoUrl" property="photoUrl" />
        <result column="date" property="date"/>
        <association property="classes" javaType="Classes">
            <id column="classes_id" property="id" />
            <result column="classes_name" property="name" />
        </association>
        <association property="discipline" javaType="Discipline">
            <id column="discipline_id" property="id" />
            <result column="discipline_name" property="name" />
        </association>
        <association property="college" javaType="College">
            <id column="college_id" property="id" />
            <result column="college_name" property="name" />
        </association>
    </resultMap>
</mapper>